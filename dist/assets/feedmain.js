import{r,h as x,j as t,S as m,N as g,P as S,a as v,b,c as j}from"./index.js";import{s as a,E}from"./effect-coverflow.js";function I({images:o}){const l=r.useRef(null),[d,w]=r.useState(null),[f,h]=r.useState(null);r.useEffect(()=>{const e=s=>{if(b.includes(s.origin)){const{action:c,scene:i}=s.data;if(c==="changeSlide"&&!isNaN(i)){const p=l.current.swiper,n=o[i-1];n&&window.parent.postMessage({url:n.url,title:n.title,explanation:n.explanation,source:"feedmain"},"*"),i>0&&i<=18&&l.current?p.slideToLoop(i-1):p.slideToLoop(0)}}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[o]);const u=(e,s,c,i,p)=>{w(s),h(p);const n=e+1;console.log("Slide clicked, real index:",n),l.current.swiper&&l.current.swiper.slideToLoop(e),window.parent.postMessage({index:n,url:s,title:c,explanation:i,source:"feedmain"},"*")};return r.useEffect(()=>{x()},[o]),t.jsxs("div",{className:a.swiperContainer,children:[t.jsx(m,{effect:"slide",grabCursor:!0,loop:o.length>3,centeredSlides:!0,slidesPerView:"auto",modules:[g,S],spaceBetween:0,navigation:!0,pagination:{clickable:!0},className:a.mySwiper,slidesPerGroup:1,ref:l,children:o.map((e,s)=>t.jsx(v,{className:a.swiperSlide,onClick:()=>u(s,e.url,e.title,e.explanation,e.media_type),children:t.jsxs("a",{href:"#",onClick:c=>c.preventDefault(),children:[e.media_type==="video"?t.jsx("iframe",{src:e.url,title:e.title,allowFullScreen:!0}):t.jsx("img",{src:e.url,alt:e.title||"Slide Image"}),t.jsx("p",{children:e.title})]})},s))}),d&&t.jsx("div",{className:a.lightbox,onClick:()=>w(null),children:f==="video"?t.jsx("iframe",{className:a.lightboxImg,src:d,alt:"Enlarged Video",allowFullScreen:!0}):t.jsx("img",{className:a.lightboxImg,src:d,alt:"Enlarged Image"})})]})}function k({images:o}){const l=r.useRef(null),[d,w]=r.useState(null),[f,h]=r.useState(null);r.useEffect(()=>{const e=s=>{if(b.includes(s.origin)){const{action:c,scene:i}=s.data;if(c==="changeSlide"&&!isNaN(i)){const p=l.current.swiper,n=o[i-1];n&&window.parent.postMessage({url:n.url,title:n.title,explanation:n.explanation,source:"feedmain"},"*"),i>0&&i<=18&&l.current?p.slideToLoop(i-1):p.slideToLoop(0)}}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[o]);const u=(e,s,c,i,p)=>{w(s),h(p);const n=e+1;console.log("Slide clicked, real index:",n),l.current.swiper&&l.current.swiper.slideToLoop(e),window.parent.postMessage({index:n,url:s,title:c,explanation:i,source:"feedmain"},"*")};return r.useEffect(()=>{x()},[o]),t.jsxs("div",{className:a.swiperContainer,children:[t.jsx(m,{effect:"coverflow",grabCursor:!0,loop:o.length>3,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:40,stretch:0,depth:100,modifier:1,slideShadows:!1},modules:[E,g,S],spaceBetween:50,navigation:!0,pagination:{clickable:!0},className:a.mySwiper,slidesPerGroup:1,ref:l,children:o.map((e,s)=>t.jsx(v,{className:a.swiperSlide,onClick:()=>u(s,e.url,e.title,e.explanation,e.media_type),children:t.jsxs("a",{href:"#",onClick:c=>c.preventDefault(),children:[e.media_type==="video"?t.jsx("iframe",{src:e.url,title:e.title,allowFullScreen:!0}):t.jsx("img",{src:e.url,alt:e.title||"Slide Image"}),t.jsx("p",{children:e.title})]})},s))}),d&&t.jsx("div",{className:a.lightbox,onClick:()=>w(null),children:f==="video"?t.jsx("iframe",{className:a.lightboxImg,src:d,alt:"Enlarged Video",allowFullScreen:!0}):t.jsx("img",{className:a.lightboxImg,src:d,alt:"Enlarged Image"})})]})}function M(){const[o,l]=r.useState(window.innerWidth<800),[d,w]=r.useState([]),[f,h]=r.useState(!1);return r.useEffect(()=>{const u=()=>h(window.parent.document.body.classList.contains("dark"));u();const e=new MutationObserver(u);return e.observe(window.parent.document.body,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),r.useEffect(()=>{const u=()=>l(window.innerWidth<800);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),r.useEffect(()=>{(async()=>{try{const e=await fetch("https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&hd=True&count=18");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();w(s)}catch(e){console.error("Failed to fetch images: "+e)}})()},[]),t.jsx("div",{className:`${f?a.dark:""}`,children:o?t.jsx(I,{images:d}):t.jsx(k,{images:d})})}j(document.getElementById("root")).render(t.jsx(r.StrictMode,{children:t.jsx(M,{})}));
